<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.varchar.www.model.dao.StudentDAO">
	<select id="getStudentInfo" parameterType="String" resultType="com.varchar.www.model.domain.student.Student">
		select u.user_id, u.user_name, u.school_name, 	u.user_tel, u.user_parent_tel, u.user_birth, u.user_email, u.user_address, u.user_image, u.user_remark,
		          a.academic_type_name
		from academy_user u, academic_type a
		where u.user_id = #{user_id}
		and u.academic_type_code = a.academic_type_code
	</select>
	
	<select id="getStudentList" resultType="com.varchar.www.model.domain.student.Student">
	<![CDATA[
	select *
	from (
			select rownum rn, a.*, b.academic_type_name, ats.attendance_state_name
			from academy_user a
					inner join academic_type b
					on a.academic_type_code = b.academic_type_code
					inner join attendance att
					on a.user_id = att.user_id
					inner join attendance_state ats
					on att.attendance_state_code = ats.attendance_state_code
			where authority_code = '3'
			and rownum <= #{cri.pageNum} * #{cri.amount}
			)
	where rn > (#{cri.pageNum} - 1) * #{cri.amount} 
	]]>
	</select>
	
	<select id="getStudentAccount" parameterType="String" resultType="int">
		select count(*) from academy_user where authority_code = #{authorityCode}
	</select>
	
	<insert id="insertStudent" parameterType="com.varchar.www.model.domain.student.Student">
		insert into academy_user(user_id, user_password, user_name, authority_code, academic_type_code, user_birth, user_tel, user_parent_tel, school_name, user_address, user_remark, user_registration, user_image) 
		values ('187-'||userSeq.nextval, #{userPassword}, #{userName}, '3',#{academicTypeCode},#{userBirth}, #{userTel}, #{userParentTel}, #{schoolName}, #{userAddress}, #{userRemark}, (select sysdate from dual), #{userImage})

	</insert>
	
	<update id="modifyStudent" parameterType="com.varchar.www.model.domain.student.Student">
		update academy_user
		set user_name = #{userName}, user_birth = #{userBirth}, user_tel = #{userTel}, user_parent_tel = #{userParentTel}, school_name = #{schoolName}, academic_type_code = #{academicTypeCode}, user_address = #{userAddress}, user_remark = #{userRemark}
		where user_id = #{userId}
	</update>
	
	<delete id="deleteStudent" parameterType="String">
		delete from academy_user where user_id = #{userId}
	</delete>
	
	
	<insert id="insertLectureForPayment">
		INSERT INTO ACADEMY_PAYMENT VALUES(
			SEQ_ACADEMY_PAYMENT.nextval, #{paymentMethodNo}, #{userId}, #{lectureCode},
			TO_DATE( SYSDATE , 'YYYY-MM-DD HH24:MI:SS' )
		)
	</insert>
	
</mapper>
