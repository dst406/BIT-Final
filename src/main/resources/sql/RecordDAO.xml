<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.varchar.www.model.dao.RecordDAO">
	<select id="getRecordList" parameterType="String"
		resultType="com.varchar.www.model.domain.record.Record">
		SELECT u.user_id, u.user_name, u.school_name,
			r.age, r.korean_language, r.english, r.math, r.social, r.science,
			r.korean_history, r.rank,
			t.test_name
		FROM academy_user u, record r, test t
		WHERE u.user_id = r.user_id
		AND
			r.test_no = t.test_no
	</select>

	<select id="getStudentRecord" parameterType="String"
		resultType="com.varchar.www.model.domain.record.Record">
		SELECT u.user_id, u.user_name, u.school_name,
			r.age, r.korean_language, r.english, r.math, r.social, r.science,
			r.korean_history, r.sum, r.sum/6 as avg, r.test_no,
			t.test_name,
			r.rank
		FROM academy_user u, test t,
		(SELECT r2.user_id user_id, r2.age age, r2.korean_language korean_language,
			r2.english english, r2.math math, r2.social social, r2.science
			science, r2.korean_history korean_history,
			r2.sum sum, r2.sum/6 as avg, r2.test_no test_no,
			rank() over(partition by r2.test_no order by r2.sum desc) as rank
		FROM record r2) r
		WHERE u.user_id = r.user_id
		AND r.user_id = #{userId}
		AND r.test_no = t.test_no

	</select>
</mapper>